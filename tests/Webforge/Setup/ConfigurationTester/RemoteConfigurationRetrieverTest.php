<?php

namespace Webforge\Setup\ConfigurationTester;

use Webforge\Code\Test\GuzzleMocker;

class RemoteConfigurationRetrieverTest extends \Webforge\Code\Test\Base {
  
  protected $retriever;
  protected $dispatcher, $iniResponse, $jsonConverter;
  
  public function setUp() {
    $this->chainClass = 'Webforge\Setup\RemoteConfigurationRetriever';
    parent::setUp();

    $this->guzzleMocker = new GuzzleMocker($this->getPackageDir('tests/files/responses/'));
    $this->client = $this->guzzleMocker->getClient();

    $this->jsonInis = json_encode(ini_get_all());
  }
  
  public function testAcceptance() {
    $this->guzzleMocker->addResponse('ini-response');
    
    $this->createRetriever();

    $inis = (array) json_decode('{"allow_url_fopen":{"global_value":"1","local_value":"1","access":4},"allow_url_include":{"global_value":"","local_value":"","access":4},"always_populate_raw_post_data":{"global_value":"0","local_value":"0","access":6},"apc.cache_by_default":{"global_value":"1","local_value":"1","access":7},"apc.canonicalize":{"global_value":"1","local_value":"1","access":4},"apc.coredump_unmap":{"global_value":"0","local_value":"0","access":4},"apc.enable_cli":{"global_value":"0","local_value":"0","access":4},"apc.enabled":{"global_value":"1","local_value":"1","access":4},"apc.file_md5":{"global_value":"0","local_value":"0","access":4},"apc.file_update_protection":{"global_value":"2","local_value":"2","access":4},"apc.filters":{"global_value":null,"local_value":null,"access":4},"apc.gc_ttl":{"global_value":"3600","local_value":"3600","access":4},"apc.include_once_override":{"global_value":"0","local_value":"0","access":4},"apc.lazy_classes":{"global_value":"0","local_value":"0","access":4},"apc.lazy_functions":{"global_value":"0","local_value":"0","access":4},"apc.max_file_size":{"global_value":"1M","local_value":"1M","access":4},"apc.num_files_hint":{"global_value":"1000","local_value":"1000","access":4},"apc.preload_path":{"global_value":null,"local_value":null,"access":4},"apc.report_autofilter":{"global_value":"0","local_value":"0","access":4},"apc.rfc1867":{"global_value":"0","local_value":"0","access":4},"apc.rfc1867_freq":{"global_value":"0","local_value":"0","access":4},"apc.rfc1867_name":{"global_value":"APC_UPLOAD_PROGRESS","local_value":"APC_UPLOAD_PROGRESS","access":4},"apc.rfc1867_prefix":{"global_value":"upload_","local_value":"upload_","access":4},"apc.rfc1867_ttl":{"global_value":"3600","local_value":"3600","access":4},"apc.serializer":{"global_value":"default","local_value":"default","access":4},"apc.shm_segments":{"global_value":"1","local_value":"1","access":4},"apc.shm_size":{"global_value":"128M","local_value":"128M","access":4},"apc.shm_strings_buffer":{"global_value":"4M","local_value":"4M","access":4},"apc.slam_defense":{"global_value":"1","local_value":"1","access":4},"apc.stat":{"global_value":"1","local_value":"1","access":4},"apc.stat_ctime":{"global_value":"0","local_value":"0","access":4},"apc.ttl":{"global_value":"0","local_value":"0","access":4},"apc.use_request_time":{"global_value":"1","local_value":"1","access":7},"apc.user_entries_hint":{"global_value":"4096","local_value":"4096","access":4},"apc.user_ttl":{"global_value":"0","local_value":"0","access":4},"apc.write_lock":{"global_value":"1","local_value":"1","access":4},"arg_separator.input":{"global_value":"&","local_value":"&","access":6},"arg_separator.output":{"global_value":"&","local_value":"&","access":7},"asp_tags":{"global_value":"","local_value":"","access":6},"assert.active":{"global_value":"1","local_value":"1","access":7},"assert.bail":{"global_value":"0","local_value":"0","access":7},"assert.callback":{"global_value":null,"local_value":null,"access":7},"assert.quiet_eval":{"global_value":"0","local_value":"0","access":7},"assert.warning":{"global_value":"1","local_value":"1","access":7},"auto_append_file":{"global_value":"","local_value":"","access":6},"auto_detect_line_endings":{"global_value":"0","local_value":"0","access":7},"auto_globals_jit":{"global_value":"1","local_value":"1","access":6},"auto_prepend_file":{"global_value":"","local_value":"D:\\www\\psc-cms\\bootstrap.php","access":6},"bcmath.scale":{"global_value":"0","local_value":"0","access":7},"browscap":{"global_value":null,"local_value":null,"access":4},"curl.cainfo":{"global_value":"","local_value":"","access":4},"date.default_latitude":{"global_value":"31.7667","local_value":"31.7667","access":7},"date.default_longitude":{"global_value":"35.2333","local_value":"35.2333","access":7},"date.sunrise_zenith":{"global_value":"90.583333","local_value":"90.583333","access":7},"date.sunset_zenith":{"global_value":"90.583333","local_value":"90.583333","access":7},"date.timezone":{"global_value":"Europe\/Berlin","local_value":"Europe\/Berlin","access":7},"default_charset":{"global_value":"","local_value":"","access":7},"default_mimetype":{"global_value":"text\/html","local_value":"text\/html","access":7},"default_socket_timeout":{"global_value":"60","local_value":"60","access":7},"disable_classes":{"global_value":"","local_value":"","access":4},"disable_functions":{"global_value":"","local_value":"","access":4},"display_errors":{"global_value":"1","local_value":"1","access":7},"display_startup_errors":{"global_value":"","local_value":"","access":7},"doc_root":{"global_value":null,"local_value":null,"access":4},"docref_ext":{"global_value":"","local_value":"","access":7},"docref_root":{"global_value":"","local_value":"","access":7},"enable_dl":{"global_value":"","local_value":"","access":4},"enable_post_data_reading":{"global_value":"1","local_value":"1","access":6},"engine":{"global_value":"1","local_value":"1","access":7},"error_append_string":{"global_value":null,"local_value":null,"access":7},"error_log":{"global_value":"C:\\Windows\\temp\\php-errors.log","local_value":"C:\\Windows\\temp\\php-errors.log","access":7},"error_prepend_string":{"global_value":null,"local_value":null,"access":7},"error_reporting":{"global_value":"32767","local_value":"32767","access":7},"exif.decode_jis_intel":{"global_value":"JIS","local_value":"JIS","access":7},"exif.decode_jis_motorola":{"global_value":"JIS","local_value":"JIS","access":7},"exif.decode_unicode_intel":{"global_value":"UCS-2LE","local_value":"UCS-2LE","access":7},"exif.decode_unicode_motorola":{"global_value":"UCS-2BE","local_value":"UCS-2BE","access":7},"exif.encode_jis":{"global_value":"","local_value":"","access":7},"exif.encode_unicode":{"global_value":"ISO-8859-15","local_value":"ISO-8859-15","access":7},"exit_on_timeout":{"global_value":"0","local_value":"0","access":7},"expose_php":{"global_value":"1","local_value":"1","access":4},"extension_dir":{"global_value":"D:\\www\\configuration\\PHP\\ext","local_value":"D:\\www\\configuration\\PHP\\ext","access":4},"file_uploads":{"global_value":"1","local_value":"1","access":4},"filter.default":{"global_value":"unsafe_raw","local_value":"unsafe_raw","access":6},"filter.default_flags":{"global_value":null,"local_value":null,"access":6},"from":{"global_value":null,"local_value":null,"access":7},"gd.jpeg_ignore_warning":{"global_value":"0","local_value":"0","access":7},"highlight.comment":{"global_value":"#FF8000","local_value":"#FF8000","access":7},"highlight.default":{"global_value":"#0000BB","local_value":"#0000BB","access":7},"highlight.html":{"global_value":"#000000","local_value":"#000000","access":7},"highlight.keyword":{"global_value":"#007700","local_value":"#007700","access":7},"highlight.string":{"global_value":"#DD0000","local_value":"#DD0000","access":7},"html_errors":{"global_value":"","local_value":"","access":7},"iconv.input_encoding":{"global_value":"ISO-8859-1","local_value":"ISO-8859-1","access":7},"iconv.internal_encoding":{"global_value":"ISO-8859-1","local_value":"ISO-8859-1","access":7},"iconv.output_encoding":{"global_value":"ISO-8859-1","local_value":"ISO-8859-1","access":7},"ignore_repeated_errors":{"global_value":"","local_value":"","access":7},"ignore_repeated_source":{"global_value":"","local_value":"","access":7},"ignore_user_abort":{"global_value":"0","local_value":"0","access":7},"implicit_flush":{"global_value":"","local_value":"","access":7},"include_path":{"global_value":".;C:\\PROGRA~1\\PHP\\PEAR;D:\\www\\Configuration\\phpunit\\vendor\\phpunit\\phpunit","local_value":"D:\\www\\psc-cms\\application\\src\\","access":7},"intl.default_locale":{"global_value":null,"local_value":null,"access":7},"intl.error_level":{"global_value":"0","local_value":"0","access":7},"last_modified":{"global_value":"0","local_value":"0","access":7},"log_errors":{"global_value":"1","local_value":"1","access":7},"log_errors_max_len":{"global_value":"0","local_value":"0","access":7},"mail.add_x_header":{"global_value":"1","local_value":"1","access":6},"mail.force_extra_parameters":{"global_value":null,"local_value":null,"access":6},"mail.log":{"global_value":null,"local_value":null,"access":6},"max_execution_time":{"global_value":"0","local_value":"0","access":7},"max_file_uploads":{"global_value":"20","local_value":"20","access":6},"max_input_nesting_level":{"global_value":"64","local_value":"64","access":6},"max_input_time":{"global_value":"60","local_value":"60","access":6},"max_input_vars":{"global_value":"1000","local_value":"1000","access":6},"mbstring.detect_order":{"global_value":null,"local_value":null,"access":7},"mbstring.encoding_translation":{"global_value":"0","local_value":"0","access":6},"mbstring.func_overload":{"global_value":"0","local_value":"0","access":4},"mbstring.http_input":{"global_value":"pass","local_value":"pass","access":7},"mbstring.http_output":{"global_value":"pass","local_value":"pass","access":7},"mbstring.http_output_conv_mimetypes":{"global_value":"^(text\/|application\/xhtml\\+xml)","local_value":"^(text\/|application\/xhtml\\+xml)","access":7},"mbstring.internal_encoding":{"global_value":"UTF-8","local_value":"UTF-8","access":7},"mbstring.language":{"global_value":"neutral","local_value":"neutral","access":7},"mbstring.strict_detection":{"global_value":"0","local_value":"0","access":7},"mbstring.substitute_character":{"global_value":null,"local_value":null,"access":7},"mcrypt.algorithms_dir":{"global_value":null,"local_value":null,"access":7},"mcrypt.modes_dir":{"global_value":null,"local_value":null,"access":7},"memory_limit":{"global_value":"1024M","local_value":"1024M","access":7},"mysql.allow_local_infile":{"global_value":"1","local_value":"1","access":4},"mysql.allow_persistent":{"global_value":"1","local_value":"1","access":4},"mysql.connect_timeout":{"global_value":"60","local_value":"60","access":7},"mysql.default_host":{"global_value":"","local_value":"","access":7},"mysql.default_password":{"global_value":"","local_value":"","access":7},"mysql.default_port":{"global_value":"","local_value":"","access":7},"mysql.default_socket":{"global_value":null,"local_value":null,"access":7},"mysql.default_user":{"global_value":"","local_value":"","access":7},"mysql.max_links":{"global_value":"-1","local_value":"-1","access":4},"mysql.max_persistent":{"global_value":"-1","local_value":"-1","access":4},"mysql.trace_mode":{"global_value":"","local_value":"","access":7},"mysqli.allow_local_infile":{"global_value":"1","local_value":"1","access":4},"mysqli.allow_persistent":{"global_value":"1","local_value":"1","access":4},"mysqli.default_host":{"global_value":"","local_value":"","access":7},"mysqli.default_port":{"global_value":"3306","local_value":"3306","access":7},"mysqli.default_pw":{"global_value":"","local_value":"","access":7},"mysqli.default_socket":{"global_value":null,"local_value":null,"access":7},"mysqli.default_user":{"global_value":"","local_value":"","access":7},"mysqli.max_links":{"global_value":"-1","local_value":"-1","access":4},"mysqli.max_persistent":{"global_value":"-1","local_value":"-1","access":4},"mysqli.reconnect":{"global_value":"","local_value":"","access":4},"mysqlnd.collect_memory_statistics":{"global_value":"","local_value":"","access":4},"mysqlnd.collect_statistics":{"global_value":"1","local_value":"1","access":7},"mysqlnd.debug":{"global_value":null,"local_value":null,"access":4},"mysqlnd.log_mask":{"global_value":"0","local_value":"0","access":7},"mysqlnd.mempool_default_size":{"global_value":"16000","local_value":"16000","access":7},"mysqlnd.net_cmd_buffer_size":{"global_value":"4096","local_value":"4096","access":7},"mysqlnd.net_read_buffer_size":{"global_value":"32768","local_value":"32768","access":7},"mysqlnd.net_read_timeout":{"global_value":"31536000","local_value":"31536000","access":4},"odbc.allow_persistent":{"global_value":"1","local_value":"1","access":4},"odbc.check_persistent":{"global_value":"1","local_value":"1","access":4},"odbc.default_cursortype":{"global_value":"3","local_value":"3","access":7},"odbc.default_db":{"global_value":null,"local_value":null,"access":7},"odbc.default_pw":{"global_value":null,"local_value":null,"access":7},"odbc.default_user":{"global_value":null,"local_value":null,"access":7},"odbc.defaultbinmode":{"global_value":"1","local_value":"1","access":7},"odbc.defaultlrl":{"global_value":"4096","local_value":"4096","access":7},"odbc.max_links":{"global_value":"-1","local_value":"-1","access":4},"odbc.max_persistent":{"global_value":"-1","local_value":"-1","access":4},"open_basedir":{"global_value":null,"local_value":null,"access":7},"output_buffering":{"global_value":"4096","local_value":"4096","access":6},"output_handler":{"global_value":null,"local_value":null,"access":6},"pcre.backtrack_limit":{"global_value":"1000000","local_value":"1000000","access":7},"pcre.recursion_limit":{"global_value":"100000","local_value":"100000","access":7},"pgsql.allow_persistent":{"global_value":"1","local_value":"1","access":4},"pgsql.auto_reset_persistent":{"global_value":"","local_value":"","access":4},"pgsql.ignore_notice":{"global_value":"0","local_value":"0","access":7},"pgsql.log_notice":{"global_value":"0","local_value":"0","access":7},"pgsql.max_links":{"global_value":"-1","local_value":"-1","access":4},"pgsql.max_persistent":{"global_value":"-1","local_value":"-1","access":4},"phar.cache_list":{"global_value":"","local_value":"","access":4},"phar.readonly":{"global_value":"","local_value":"","access":7},"phar.require_hash":{"global_value":"1","local_value":"1","access":7},"post_max_size":{"global_value":"30M","local_value":"30M","access":6},"precision":{"global_value":"14","local_value":"14","access":7},"realpath_cache_size":{"global_value":"16K","local_value":"16K","access":4},"realpath_cache_ttl":{"global_value":"120","local_value":"120","access":4},"register_argc_argv":{"global_value":"","local_value":"","access":6},"report_memleaks":{"global_value":"1","local_value":"1","access":7},"report_zend_debug":{"global_value":"1","local_value":"1","access":7},"request_order":{"global_value":"GP","local_value":"GP","access":6},"sendmail_from":{"global_value":null,"local_value":null,"access":7},"sendmail_path":{"global_value":null,"local_value":null,"access":4},"serialize_precision":{"global_value":"100","local_value":"100","access":7},"session.auto_start":{"global_value":"0","local_value":"0","access":7},"session.cache_expire":{"global_value":"180","local_value":"180","access":7},"session.cache_limiter":{"global_value":"nocache","local_value":"nocache","access":7},"session.cookie_domain":{"global_value":"","local_value":"","access":7},"session.cookie_httponly":{"global_value":"","local_value":"","access":7},"session.cookie_lifetime":{"global_value":"0","local_value":"0","access":7},"session.cookie_path":{"global_value":"\/","local_value":"\/","access":7},"session.cookie_secure":{"global_value":"","local_value":"","access":7},"session.entropy_file":{"global_value":"","local_value":"","access":7},"session.entropy_length":{"global_value":"0","local_value":"0","access":7},"session.gc_divisor":{"global_value":"1000","local_value":"1000","access":7},"session.gc_maxlifetime":{"global_value":"1440","local_value":"1440","access":7},"session.gc_probability":{"global_value":"1","local_value":"1","access":7},"session.hash_bits_per_character":{"global_value":"5","local_value":"5","access":7},"session.hash_function":{"global_value":"0","local_value":"0","access":7},"session.name":{"global_value":"PHPSESSID","local_value":"PHPSESSID","access":7},"session.referer_check":{"global_value":"","local_value":"","access":7},"session.save_handler":{"global_value":"files","local_value":"files","access":7},"session.save_path":{"global_value":"C:\\Windows\\Temp","local_value":"C:\\Windows\\Temp","access":7},"session.serialize_handler":{"global_value":"php","local_value":"php","access":7},"session.upload_progress.cleanup":{"global_value":"1","local_value":"1","access":2},"session.upload_progress.enabled":{"global_value":"1","local_value":"1","access":2},"session.upload_progress.freq":{"global_value":"1%","local_value":"1%","access":2},"session.upload_progress.min_freq":{"global_value":"1","local_value":"1","access":2},"session.upload_progress.name":{"global_value":"PHP_SESSION_UPLOAD_PROGRESS","local_value":"PHP_SESSION_UPLOAD_PROGRESS","access":2},"session.upload_progress.prefix":{"global_value":"upload_progress_","local_value":"upload_progress_","access":2},"session.use_cookies":{"global_value":"1","local_value":"1","access":7},"session.use_only_cookies":{"global_value":"1","local_value":"1","access":7},"session.use_trans_sid":{"global_value":"0","local_value":"0","access":7},"short_open_tag":{"global_value":"1","local_value":"1","access":6},"SMTP":{"global_value":"localhost","local_value":"localhost","access":7},"smtp_port":{"global_value":"25","local_value":"25","access":7},"soap.wsdl_cache":{"global_value":"1","local_value":"1","access":7},"soap.wsdl_cache_dir":{"global_value":"\/tmp","local_value":"\/tmp","access":7},"soap.wsdl_cache_enabled":{"global_value":"1","local_value":"1","access":7},"soap.wsdl_cache_limit":{"global_value":"5","local_value":"5","access":7},"soap.wsdl_cache_ttl":{"global_value":"86400","local_value":"86400","access":7},"sql.safe_mode":{"global_value":"","local_value":"","access":4},"sqlite3.extension_dir":{"global_value":null,"local_value":null,"access":4},"tidy.clean_output":{"global_value":"","local_value":"","access":1},"tidy.default_config":{"global_value":"","local_value":"","access":4},"track_errors":{"global_value":"","local_value":"","access":7},"unserialize_callback_func":{"global_value":"","local_value":"","access":7},"upload_max_filesize":{"global_value":"30M","local_value":"30M","access":6},"upload_tmp_dir":{"global_value":"C:\\Windows\\Temp","local_value":"C:\\Windows\\Temp","access":4},"url_rewriter.tags":{"global_value":"a=href,area=href,frame=src,input=src,form=fakeentry","local_value":"a=href,area=href,frame=src,input=src,form=fakeentry","access":7},"user_agent":{"global_value":null,"local_value":null,"access":7},"user_dir":{"global_value":"","local_value":"","access":4},"user_ini.cache_ttl":{"global_value":"300","local_value":"300","access":4},"user_ini.filename":{"global_value":".user.ini","local_value":".user.ini","access":4},"variables_order":{"global_value":"GPCS","local_value":"GPCS","access":6},"windows.show_crt_warning":{"global_value":"0","local_value":"0","access":7},"xbithack":{"global_value":"0","local_value":"0","access":7},"xdebug.auto_trace":{"global_value":"1","local_value":"1","access":7},"xdebug.cli_color":{"global_value":"1","local_value":"1","access":7},"xdebug.collect_assignments":{"global_value":"0","local_value":"0","access":7},"xdebug.collect_includes":{"global_value":"1","local_value":"1","access":7},"xdebug.collect_params":{"global_value":"0","local_value":"0","access":7},"xdebug.collect_return":{"global_value":"0","local_value":"0","access":7},"xdebug.collect_vars":{"global_value":"0","local_value":"0","access":7},"xdebug.coverage_enable":{"global_value":"1","local_value":"1","access":4},"xdebug.default_enable":{"global_value":"1","local_value":"1","access":7},"xdebug.dump.COOKIE":{"global_value":null,"local_value":null,"access":7},"xdebug.dump.ENV":{"global_value":null,"local_value":null,"access":7},"xdebug.dump.FILES":{"global_value":null,"local_value":null,"access":7},"xdebug.dump.GET":{"global_value":null,"local_value":null,"access":7},"xdebug.dump.POST":{"global_value":null,"local_value":null,"access":7},"xdebug.dump.REQUEST":{"global_value":null,"local_value":null,"access":7},"xdebug.dump.SERVER":{"global_value":null,"local_value":null,"access":7},"xdebug.dump.SESSION":{"global_value":null,"local_value":null,"access":7},"xdebug.dump_globals":{"global_value":"1","local_value":"1","access":7},"xdebug.dump_once":{"global_value":"1","local_value":"1","access":7},"xdebug.dump_undefined":{"global_value":"0","local_value":"0","access":7},"xdebug.extended_info":{"global_value":"1","local_value":"1","access":4},"xdebug.file_link_format":{"global_value":"","local_value":"","access":7},"xdebug.idekey":{"global_value":"psc-9230xdflgkj345","local_value":"psc-9230xdflgkj345","access":7},"xdebug.max_nesting_level":{"global_value":"200","local_value":"200","access":7},"xdebug.overload_var_dump":{"global_value":"0","local_value":"0","access":6},"xdebug.profiler_aggregate":{"global_value":"0","local_value":"0","access":6},"xdebug.profiler_append":{"global_value":"0","local_value":"0","access":6},"xdebug.profiler_enable":{"global_value":"0","local_value":"0","access":6},"xdebug.profiler_enable_trigger":{"global_value":"1","local_value":"1","access":6},"xdebug.profiler_output_dir":{"global_value":"D:\/www\/xdebugOutput","local_value":"D:\/www\/xdebugOutput","access":6},"xdebug.profiler_output_name":{"global_value":"cachegrind.out.%s.%R","local_value":"cachegrind.out.%s.%R","access":6},"xdebug.remote_autostart":{"global_value":"0","local_value":"0","access":7},"xdebug.remote_connect_back":{"global_value":"0","local_value":"0","access":7},"xdebug.remote_cookie_expire_time":{"global_value":"3600","local_value":"3600","access":7},"xdebug.remote_enable":{"global_value":"1","local_value":"1","access":6},"xdebug.remote_handler":{"global_value":"dbgp","local_value":"dbgp","access":7},"xdebug.remote_host":{"global_value":"localhost","local_value":"localhost","access":7},"xdebug.remote_log":{"global_value":"","local_value":"","access":7},"xdebug.remote_mode":{"global_value":"req","local_value":"req","access":7},"xdebug.remote_port":{"global_value":"9000","local_value":"9000","access":7},"xdebug.scream":{"global_value":"0","local_value":"0","access":7},"xdebug.show_exception_trace":{"global_value":"0","local_value":"0","access":7},"xdebug.show_local_vars":{"global_value":"0","local_value":"0","access":7},"xdebug.show_mem_delta":{"global_value":"0","local_value":"0","access":7},"xdebug.trace_enable_trigger":{"global_value":"0","local_value":"0","access":6},"xdebug.trace_format":{"global_value":"1","local_value":"1","access":7},"xdebug.trace_options":{"global_value":"0","local_value":"0","access":7},"xdebug.trace_output_dir":{"global_value":"\\","local_value":"\\","access":7},"xdebug.trace_output_name":{"global_value":"trace.%c","local_value":"trace.%c","access":7},"xdebug.var_display_max_children":{"global_value":"128","local_value":"128","access":7},"xdebug.var_display_max_data":{"global_value":"512","local_value":"512","access":7},"xdebug.var_display_max_depth":{"global_value":"3","local_value":"3","access":7},"xmlrpc_error_number":{"global_value":"0","local_value":"0","access":7},"xmlrpc_errors":{"global_value":"0","local_value":"0","access":4},"xsl.security_prefs":{"global_value":"44","local_value":"44","access":7},"zend.detect_unicode":{"global_value":"1","local_value":"1","access":7},"zend.enable_gc":{"global_value":"1","local_value":"1","access":7},"zend.multibyte":{"global_value":"0","local_value":"0","access":2},"zend.script_encoding":{"global_value":null,"local_value":null,"access":7},"zlib.output_compression":{"global_value":"","local_value":"","access":7},"zlib.output_compression_level":{"global_value":"-1","local_value":"-1","access":7},"zlib.output_handler":{"global_value":"","local_value":"","access":7}}');
    
    // vergleiche unsere gemockten ini values
    foreach ($inis as $iniName => $iniInfo) {
      $iniValue = $iniInfo['local_value'];
      $this->assertEquals($iniValue, $this->retriever->retrieveIni($iniName), 'iniValue for '.$iniName.' is not correct');
    }
  }
  
  public function testJSONEncodingFailureThrowsBetterException() {
    $this->guzzleMocker->addResponse('ini-response');

    $this->jsonConverter = $this->getMock('Webforge\Common\JS\JSONConverter', array('parse'));
    $this->jsonConverter->expects($this->once())->method('parse')
                        ->will($this->throwException(new \Webforge\Common\JS\JSONParsingException('cannot parse JSON its mailformed')));
    
    $this->createRetriever();
    
    $this->setExpectedException('RuntimeException');
    $this->retriever->retrieveIni('error_reporting');
  }

  protected function createRetriever() {
    $this->retriever = new RemoteConfigurationRetriever('http://is-mocked/dump-inis.php', $this->client, $this->jsonConverter);
  }

  public function testToStringIsNotEmpty() {
    $this->createRetriever();
    $this->assertNotEmpty((string) $this->retriever);
  }
}
